# Example: Update Customer Endpoint (PUT)
# This endpoint demonstrates a write operation for updating customer records

url-path: /customers/:customer_id
method: PUT

# Operation configuration
operation:
  type: write
  returns-data: true          # Return the updated record
  transaction: true
  validate-before-write: true

# Request parameters
request:
  - field-name: customer_id
    field-in: path
    description: Customer ID to update
    required: true
    validators:
      - type: int
        min: 1

  - field-name: name
    field-in: body
    description: Updated customer name
    required: false
    validators:
      - type: string
        min: 1
        max: 255
        preventSqlInjection: true

  - field-name: email
    field-in: body
    description: Updated email address
    required: false
    validators:
      - type: email

  - field-name: phone
    field-in: body
    description: Updated phone number
    required: false
    validators:
      - type: string
        regex: '^\+?[1-9]\d{1,14}$'

template-source: update-customer.sql
connection:
  - customer-db

# Cache configuration - refresh immediately after update
cache:
  enabled: true
  table: customers_cache
  invalidate-on-write: true
  refresh-on-write: true      # Refresh cache immediately after update

auth:
  enabled: true
  type: basic
  users:
    - username: api_user
      password: '{{env.API_PASSWORD}}'
      roles: [write]

