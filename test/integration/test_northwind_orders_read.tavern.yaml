---
test_name: Northwind Orders Read Operations
marks:
  - integration
  - northwind
  - read-only

stages:
  - name: Get all orders (no filters)
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
    response:
      status_code: 200
      headers:
        content-type: "application/json"
        x-total-count: !anystr
      json: !anything

  - name: Get orders with pagination
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        offset: 0
        limit: 10
    response:
      status_code: 200
      headers:
        content-type: "application/json"
        x-offset: "0"
        x-limit: "10"
      json: !anything

  - name: Get order by order_id filter
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        order_id: 10248
    response:
      status_code: 200
      headers:
        content-type: "application/json"
      json: !anything

  - name: Get orders by customer_id filter
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        customer_id: "ALFKI"
    response:
      status_code: 200
      headers:
        content-type: "application/json"
      json: !anything

  - name: Get orders by order_date filter
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        order_date: "1996-07-04"
    response:
      status_code: 200
      headers:
        content-type: "application/json"
      json: !anything

  - name: Get orders by shipped_date filter
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        shipped_date: "1996-07-16"
    response:
      status_code: 200
      headers:
        content-type: "application/json"
      json: !anything

  - name: Get orders with date range (multiple filters)
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        order_date: "1996-07-04"
        customer_id: "ALFKI"
    response:
      status_code: 200
      headers:
        content-type: "application/json"
      json: !anything

  - name: Get orders - invalid order_id (below minimum)
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        order_id: 0
    response:
      status_code: 400
      headers:
        content-type: "application/json"
      json:
        errors: !anything

  - name: Get orders - invalid order_date format
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        order_date: "invalid-date"
    response:
      status_code: 400
      headers:
        content-type: "application/json"
      json:
        errors: !anything

  - name: Get orders - SQL injection attempt in customer_id
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        customer_id: "'; DROP TABLE Orders; --"
    response:
      status_code: 400
      headers:
        content-type: "application/json"
      json:
        errors: !anything

  - name: Get orders - verify Order Details are joined
    request:
      url: "{base_url}/northwind/orders/"
      method: GET
      params:
        order_id: 10248
    response:
      status_code: 200
      headers:
        content-type: "application/json"
      json: !anything
      # Should contain order details in the response (structure depends on SQL query)

